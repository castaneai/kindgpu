apiVersion: v1
kind: Pod
metadata:
  name: vulkan-pod
  labels:
    component: vnc
spec:
  volumes:
    - name: x11
      emptyDir:
        medium: Memory
        sizeLimit: 10Mi
  containers:
    - name: app
      image: vulkan-pod-app:fixed
      command: ["/bin/bash", "-c", "--"]
      args: ["while true; do sleep 600; done;"]
      env:
        - name: DISPLAY
          value: ":0"
        - name: LD_LIBRARY_PATH
          # https://github.com/GoogleCloudPlatform/container-engine-accelerators/blob/176ef225b975c536ac31c1155fd33c3122cdb732/cmd/nvidia_gpu/nvidia_gpu.go#L40
          value: /usr/local/nvidia/lib64
      resources:
        limits:
          nvidia.com/gpu: "1"
      volumeMounts:
        - name: x11
          mountPath: /tmp/.X11-unix
    - name: xserver
      image: vulkan-pod-xserver:fixed
      env:
        - name: DISPLAY
          value: ":0"
      ports:
        - name: x11vnc
          containerPort: 5900
      volumeMounts:
        - name: x11
          mountPath: /tmp/.X11-unix
---
kind: Service
apiVersion: v1
metadata:
  name: vnc
spec:
  selector:
    component: vnc
  type: NodePort
  ports:
    - name: vnc
      port: 5900
      nodePort: 5900